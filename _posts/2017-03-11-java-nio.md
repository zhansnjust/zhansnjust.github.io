---
title: java NIO基础
date: 2017-03-11 18:09:13 +0800
layout: post
permalink: /blog/2017/03/11/java-nio.html
categories:
  - java
tags:
  - 技术
  - java
---
# 常见概念

##### 通道(channel)：相当于铁路，负责连接,打开IO设备(文件、套接字)的连接。
##### 缓冲区(buffer)：负责数据存储，底层就是数组，可以存数不同数据类型的数据。
buffer三个核心属性:
1. capacity:buffer的容量，表示缓冲区中最大的容量
2. position: 缓冲区中正在操作的位置   0《mark《 position《limit《capacity
3. limit：表示缓冲区中可以操作数据的大小(limit 后面的数据不能读写).
4. mark: 示使用mark()方法记录当前position的位置，reset()方法可以把position恢复到mark的位置.


![](/images/java/java-buffer-arr.png)

```java
package com.buffer;

import java.nio.ByteBuffer;

import org.junit.Test;

public class TestBuffer {
    @Test
    public final void test()
    {
        ByteBuffer buffer = ByteBuffer.allocate(1024);
        System.out.println(buffer.position());
        System.out.println(buffer.limit());
        System.out.println(buffer.capacity());
        buffer.put("abcde".getBytes());
        
        System.out.println("-----------");
        
        System.out.println(buffer.position());
        System.out.println(buffer.limit());
        System.out.println(buffer.capacity());
        buffer.flip(); //切换到读取模式
        
        System.out.println("-----------");
        System.out.println(buffer.position());
        System.out.println(buffer.limit());
        System.out.println(buffer.capacity());
    }
}
```
##### 直接缓冲区和非直接缓冲区
- 非直接缓冲区：通过allocate()方法分配缓冲区，将缓冲区建立在JVM的内存中。
- 直接缓冲区：通过allocateDiect

![](/images/java/nio-buffer.png)


##### 字符集 Charset
- 编码: 字符串->字符数组
- 解码：字符数组->字符串

### 阻塞和非阻塞
* 传统的 IO 流都是阻塞式的。也就是说，当一个线程调用 read() 或 write()
时，该线程被阻塞，直到有一些数据被读取或写入，该线程在此期间不
能执行其他任务。因此，在完成网络通信进行 IO 操作时，由于线程会
阻塞，所以服务器端必须为每个客户端都提供一个独立的线程进行处理，
当服务器端需要处理大量客户端时，性能急剧下降。
- Java NIO 是非阻塞模式的。当线程从某通道进行读写数据时，若没有数
据可用时，该线程可以进行其他任务。线程通常将非阻塞 IO 的空闲时
间用于在其他通道上执行 IO 操作，所以单独的线程可以管理多个输入
和输出通道。因此，NIO 可以让服务器端使用一个或有限几个线程来同
时处理连接到服务器端的所有客户端。